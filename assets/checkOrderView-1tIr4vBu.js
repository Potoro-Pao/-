import{_ as L,L as E,h as u,r as p,o as h,c as l,e as t,a as m,E as _,G as O,F as x,y as M,A as n,b as T,C as N,S as w,p as V,d as U}from"./index-Kc8cdeaF.js";import{a as y}from"./axios-L6U4YIEh.js";import{m as v}from"./mapStore--J7OMQzp.js";import{c as A}from"./confirmOrderDataStore-vqL-A-4f.js";import{T as B}from"./ToastComponent-f3p7ZQNb.js";import{S as F}from"./StepperComponent-VZBZhXIN.js";var J={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_API:"potoro",BASE_URL:"/VueMission1/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:f,VITE_API:g}=J,j={data(){return{hasCoupon:"",message:"",type:"",is_paid:!1,selectedPaymentMethod:"",isLoading:!0,checkoutData:{},orderData:{},productDetails:{},userData:{},orders:{},ordersTotal:0,checkoutOrderID:"",orderID:"",userCountryCity:{country:"",city:""}}},components:{Loading:E,ToastComponent:B,StepperComponent:F},methods:{...u(v,["setLocationFromExternal","setBookPhotoFromExternal"]),...u(A,["getOrderSuccessUserData"]),...u(v,["setLocationFromExternal","setBookPhotoFromExternal"]),confirmOrder(){const r=`${f}/api/${g}/pay/${this.orderID}`;y.post(r).then(()=>{this.isLoading=!0;const s=this.randomPhoto(this.orders);this.setLocationFromExternal(this.userCountryCity,s[0],s[1]),this.$router.push("/success")}).catch(()=>{})},randomPhoto(r){const s=Object.keys(r),a=Math.floor(Math.random()*s.length),d=s[a],o=r[d].product.title,c=r[d].product.imageUrl;return[o,c]},getOrderAll(){const r=`${f}/api/${g}/orders`;y.get(r).then(s=>{this.isLoading=!1,this.orders=s.data.orders,this.is_paid=this.orders[0].is_paid;const a=this.orders.find(d=>d.id===(this.checkoutData.orderId||this.checkoutData.id));if(a){this.isLoading=!1,this.orders=a.products,this.ordersTotal=Math.round(a.total),this.orderID=a.id,this.userData=a.user,this.userCountryCity.country=JSON.parse(this.userData.address).country,this.userCountryCity.city=JSON.parse(this.userData.address).city,this.userData.address=JSON.parse(this.userData.address).address;const d=Object.values(a.products);this.hasCoupon=d.some(o=>!!o.coupon)}else this.orders="",this.ordersTotal="",this.orderID="",this.userData="",this.userCountryCity=""}).catch(()=>{})},searchOrder(){if(this.isLoading=!0,!this.orderID){this.type="bg-danger",this.message="Please Enter the order Number",this.$refs.TToast.showToast(),this.isLoading=!1;return}const r=`${f}/api/${g}/order/${this.orderID}`;y.get(r).then(s=>{var a;this.isLoading=!1,this.orders=s.data.order.products,this.userData=s.data.order.user,this.userCountryCity.country=(a=JSON.parse(this.userData.address))==null?void 0:a.country,this.userCountryCity.city=JSON.parse(this.userData.address).city,this.userData.address=JSON.parse(this.userData.address).address,this.ordersTotal=Math.round(s.data.order.total),this.checkoutOrderID=s.data.order.id,this.orderID=s.data.order.id,this.orders&&typeof this.orders=="object"?this.hasCoupon=Object.values(this.orders).some(d=>d.coupon):this.hasCoupon=!1}).catch(()=>{this.isLoading=!1,this.type="bg-danger",this.message="Please enter the correct order number",this.$refs.TToast.showToast()})}},created(){this.checkoutData=this.getOrderSuccessUserData()},mounted(){if(this.checkoutOrderID=this.checkoutData.orderId||this.checkoutData.id,this.orderID=this.checkoutData.orderId||this.checkoutData.id,!this.checkoutOrderID||!this.orderID){this.type="bg-danger",this.message="Please enter the order number",this.$refs.TToast.showToast(),this.isLoading=!1;return}this.getOrderAll()}},i=r=>(V("data-v-73ba3830"),r=r(),U(),r),z={class:"toast-container"},R={class:"container my-5"},Y={class:"container"},q=i(()=>t("h1",{class:"text-center my-5"},"Confirm Your Payment",-1)),$={class:"row"},G={class:"mb-3"},Q=i(()=>t("label",{for:"orderId",style:{"font-size":"20px"},class:"form-label mb-3"},"Order ID",-1)),H=i(()=>t("label",{for:"searchOrderId",style:{"font-size":"20px"},class:"form-label mb-3"},"Search Order ID",-1)),K={class:"col-12"},W=i(()=>t("h5",{class:"mb-3"},"Your Orders",-1)),X={class:"list-group"},Z={class:"d-flex w-100 justify-content-between"},tt=["src"],st={class:"flex-grow-1"},et={class:"mb-3"},ot={class:"mb-1"},rt={class:"text-muted"},at={class:"mb-1 font-weight-bold text-primary",style:{"font-size":"1.25em"}},it={class:"container"},dt={class:"card"},nt={class:"card-body"},ct=i(()=>t("h5",{class:"card-title"},[t("strong",null,"Customer Information")],-1)),ht={class:"card-text"},lt={class:"card-text"},ut={class:"card-text"},pt={class:"card-text"},mt={class:"card-text font-weight-bold text-success",style:{"font-size":"1.25em"}},_t={key:0,class:"badge bg-success ml-3"},yt={key:0,class:"mt-3"},ft=i(()=>t("label",{for:"paymentMethod",class:"form-label"},"Payment Methods",-1)),gt=i(()=>t("option",{disabled:"",value:""},"Choose a payment method",-1)),Dt=i(()=>t("option",null,"Credit card",-1)),bt=i(()=>t("option",null,"Bank transfer",-1)),It=i(()=>t("option",null,"Pay when you get it (Cash on Delivery)",-1)),Ct=[gt,Dt,bt,It],Ot=["disabled"],xt={key:1},Tt=i(()=>t("p",{class:"text-danger",style:{"font-size":"30px"}}," Your shipment is on the road. ",-1)),vt=[Tt];function kt(r,s,a,d,o,c){const k=p("ToastComponent"),S=p("StepperComponent"),P=p("loading");return h(),l(x,null,[t("div",z,[m(k,{ref:"TToast",message:o.message,bgClass:o.type},null,8,["message","bgClass"])]),t("div",R,[m(S,{currentStep:3})]),m(P,{active:o.isLoading,"onUpdate:active":s[0]||(s[0]=e=>o.isLoading=e)},null,8,["active"]),t("div",Y,[q,t("div",$,[t("div",G,[Q,_(t("input",{type:"text",class:"form-control",id:"orderId","onUpdate:modelValue":s[1]||(s[1]=e=>o.checkoutOrderID=e),readonly:""},null,512),[[O,o.checkoutOrderID]]),H,_(t("input",{type:"text",class:"form-control",id:"searchOrderId","onUpdate:modelValue":s[2]||(s[2]=e=>o.orderID=e)},null,512),[[O,o.orderID]]),t("button",{type:"button",class:"btn btn-primary mt-3",onClick:s[3]||(s[3]=(...e)=>c.searchOrder&&c.searchOrder(...e))}," Search ")]),t("div",K,[W,t("div",X,[(h(!0),l(x,null,M(o.orders,e=>{var D,b,I,C;return h(),l("a",{key:e.id,class:"list-group-item list-group-item-action flex-column align-items-start"},[t("div",Z,[t("img",{src:(D=e.product)==null?void 0:D.imageUrl,alt:"Product Image",style:{width:"100px",height:"auto","margin-right":"15px"}},null,8,tt),t("div",st,[t("h5",et,n((b=e.product)==null?void 0:b.title),1),t("p",ot,[T(" Item Price: "),t("span",rt,"$"+n((I=e.product)==null?void 0:I.price)+" NTD",1)]),t("p",at," Item Total: $"+n(((C=e.product)==null?void 0:C.price)*(e==null?void 0:e.qty))+" NTD ",1)]),t("small",null,"Quantity: "+n(e==null?void 0:e.qty),1)])])}),128))])]),t("div",it,[t("div",dt,[t("div",nt,[ct,t("p",ht,"Name: "+n(this.userData.name),1),t("p",lt,"Email: "+n(this.userData.email),1),t("p",ut,"Address: "+n(this.userData.address),1),t("p",pt,"Phone: "+n(this.userData.tel),1),t("p",mt,[T(" Total: $"+n(this.ordersTotal)+" NTD ",1),o.hasCoupon?(h(),l("span",_t,"Coupon Applied")):N("",!0)])])]),this.is_paid?(h(),l("div",xt,vt)):(h(),l("div",yt,[ft,_(t("select",{class:"form-select",id:"paymentMethod","onUpdate:modelValue":s[4]||(s[4]=e=>o.selectedPaymentMethod=e)},Ct,512),[[w,o.selectedPaymentMethod]]),t("button",{type:"button",class:"btn btn-primary mt-3",disabled:!o.selectedPaymentMethod,onClick:s[5]||(s[5]=(...e)=>c.confirmOrder&&c.confirmOrder(...e))}," Confirm Payment ",8,Ot)]))])])])],64)}const wt=L(j,[["render",kt],["__scopeId","data-v-73ba3830"]]);export{wt as default};
